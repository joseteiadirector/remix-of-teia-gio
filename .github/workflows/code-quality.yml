name: Code Quality Analysis

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]
  schedule:
    - cron: '0 2 * * 1' # Toda segunda-feira Ã s 02:00

jobs:
  analyze:
    name: Code Quality Metrics
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      with:
        fetch-depth: 0
      
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20'
        cache: 'npm'
        
    - name: Install dependencies
      run: npm ci
      
    - name: Analyze code complexity
      run: |
        echo "ðŸ“Š AnÃ¡lise de complexidade do cÃ³digo..."
        echo "Total de arquivos TypeScript:"
        find src -name "*.ts" -o -name "*.tsx" | wc -l
        echo "Linhas de cÃ³digo:"
        find src -name "*.ts" -o -name "*.tsx" | xargs wc -l | tail -1
        
    - name: Check for TODO/FIXME
      run: |
        echo "ðŸ” Procurando TODOs e FIXMEs..."
        grep -r "TODO\|FIXME" src/ || echo "âœ… Nenhum TODO/FIXME encontrado"
        
    - name: Check for console.logs
      run: |
        echo "ðŸ” Verificando console.logs..."
        grep -r "console.log" src/ --exclude-dir=node_modules || echo "âœ… Nenhum console.log encontrado"
        
    - name: Analyze dependencies
      run: |
        echo "ðŸ“¦ AnÃ¡lise de dependÃªncias..."
        npm list --depth=0
        
    - name: Check for unused dependencies
      run: |
        echo "ðŸ” Verificando dependÃªncias nÃ£o utilizadas..."
        npx depcheck || echo "âš ï¸ Algumas dependÃªncias podem nÃ£o estar sendo usadas"
      continue-on-error: true
      
    - name: Generate quality report
      run: |
        echo "## ðŸ“Š Code Quality Report" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "### MÃ©tricas Gerais" >> $GITHUB_STEP_SUMMARY
        echo "- **Total de arquivos TS/TSX**: $(find src -name '*.ts' -o -name '*.tsx' | wc -l)" >> $GITHUB_STEP_SUMMARY
        echo "- **Linhas de cÃ³digo**: $(find src -name '*.ts' -o -name '*.tsx' | xargs wc -l | tail -1 | awk '{print $1}')" >> $GITHUB_STEP_SUMMARY
        echo "- **Componentes**: $(find src/components -name '*.tsx' | wc -l)" >> $GITHUB_STEP_SUMMARY
        echo "- **Pages**: $(find src/pages -name '*.tsx' | wc -l)" >> $GITHUB_STEP_SUMMARY
        echo "- **Hooks**: $(find src/hooks -name '*.ts' | wc -l)" >> $GITHUB_STEP_SUMMARY
        echo "- **Utils**: $(find src/utils -name '*.ts' | wc -l)" >> $GITHUB_STEP_SUMMARY
