# Documenta√ß√£o Oficial do Sistema Teia GEO IGO

## üìã DADOS CADASTRAIS E REGISTROS OFICIAIS

### Titular e Autor Intelectual
**JOSE ENRIQUE VASQUEZ VALENZUELA**  
CPF: 900.448.378-01  
Founder & Chief Data & AI Officer (CDAO)

### Empresa Detentora
**TEIA STUDIO TECNOLOGIA EMPRESARIAL COM INTELIG√äNCIA ARTIFICIAL LTDA**  
CNPJ: 63.049.583/0001-65  
Endere√ßo: Rua Teodoro Sampaio, 1482 - S√£o Paulo/SP - CEP: 05406-100

### Registros Oficiais
- **Processo INPI (Marca)**: 941859479 - "Teia GEO" (Classe NCL 42)
- **Protocolo MCTI/CTI**: 267175.0023774/2025 (Registro de Software)
- **Data de Solicita√ß√£o**: 08/11/2025
- **Status**: Em andamento junto ao Instituto Nacional da Propriedade Industrial

### Contatos
- Email: contato@teiastudio.com / jose.vev26@gmail.com
- Website: www.teiaestudio.com

---

## üéì FUNDAMENTA√á√ÉO CIENT√çFICA

### Observabilidade Cognitiva Generativa

O framework Teia GEO IGO (Intelligence Generative Observability) representa uma **inova√ß√£o brasileira pioneira** que prop√µe uma nova disciplina aplicada: a **Observabilidade Cognitiva Generativa**.

#### Defini√ß√£o Formal
A Observabilidade Cognitiva Generativa √© uma disciplina cient√≠fica aplicada que articula:
- **Estat√≠stica multivariada**: An√°lise quantitativa de padr√µes multi-LLM
- **Sem√¢ntica computacional**: An√°lise vetorial e similaridade sem√¢ntica
- **Epistemologia da linguagem**: Compreens√£o do comportamento simb√≥lico
- **Meta-IA**: Intelig√™ncias artificiais que analisam outras IAs

#### Diferencial √önico
Teia GEO √© a **primeira plataforma cient√≠fica e t√©cnica do mundo** para mensura√ß√£o emp√≠rica da cogni√ß√£o algor√≠tmica com foco em marcas, conceitos e entidades de relev√¢ncia p√∫blica.

### Por Que N√£o Existe "AEO" (Answer Engine Optimization)?

**Contextualiza√ß√£o Importante**: O termo "AEO" foi amplamente propagado no mercado de SEO internacional, mas **n√£o representa uma disciplina cient√≠fica ou metodologia validada**. Trata-se de uma nomenclatura de marketing sem fundamenta√ß√£o acad√™mica ou t√©cnica consistente.

#### GEO vs AEO: A Diferen√ßa Cient√≠fica

| Aspecto | AEO | GEO (Teia GEO IGO) |
|---------|-----|-------------------|
| **Fundamenta√ß√£o** | Marketing | Ci√™ncia Aplicada |
| **M√©tricas** | N√£o formalizadas | KAPIs matematicamente formalizadas |
| **Metodologia** | Emp√≠rica | Estat√≠stica cl√°ssica validada |
| **Observabilidade** | Inexistente | Meta-IA e governan√ßa completa |
| **Auditabilidade** | N√£o rastre√°vel | Versionamento completo |
| **Bibliografia** | Ausente | 30+ refer√™ncias acad√™micas |

**Conclus√£o**: AEO √© marketing; GEO (Teia GEO IGO) √© ci√™ncia aplicada.

### Fundamenta√ß√£o Te√≥rica Completa

#### 1. Epistemologia da Observabilidade Computacional
O conceito de observabilidade originou-se na **engenharia de controle** (Kalman, 1960), definindo a capacidade de inferir o estado interno de um sistema a partir de suas sa√≠das.

A **Observabilidade Cognitiva**, proposta por Jos√© Enrique V√°squez Valenzuela, eleva esse conceito para a mensura√ß√£o do comportamento sem√¢ntico e simb√≥lico dos LLMs.

**Base Te√≥rica**:
- **Kalman (1960)**: Teoria de controle e observabilidade
- **Barham et al. (2020)**: Observabilidade em sistemas computacionais
- **Minsky (1986)**: Arquiteturas reflexivas em IA

#### 2. Meta-IA: Intelig√™ncia que Observa Intelig√™ncia
A Meta-IA consiste em criar sistemas capazes de **monitorar, interpretar e prever** o comportamento de outros sistemas de IA.

No contexto do Teia GEO IGO, a Meta-IA:
- Captura respostas de m√∫ltiplos LLMs simultaneamente
- Compara e mede diverg√™ncias cognitivas
- Prediz comportamento futuro via regress√£o linear
- Detecta alucina√ß√µes e inconsist√™ncias sem√¢nticas

#### 3. KAPIs: Key Algorithmic Predictive Indicators

As **KAPIs** s√£o m√©tricas cognitivas formalizadas matematicamente para quantificar o comportamento algor√≠tmico:

1. **ICE** (Index of Cognitive Efficiency): Efici√™ncia de men√ß√µes corretas
2. **GAP** (Governance Alignment Precision): Consenso entre LLMs
3. **CPI** (Cognitive Predictive Index): Previsibilidade cognitiva composta
4. **Cognitive Stability**: Estabilidade temporal das respostas

### Metodologia Cient√≠fica

#### Coleta de Dados
- **Per√≠odo**: 30 dias de observa√ß√£o cont√≠nua
- **Provedores**: GPT (OpenAI), Claude (Anthropic), Gemini (Google), Perplexity
- **Queries**: Bateria de perguntas padronizadas por setor
- **Frequ√™ncia**: Coleta di√°ria automatizada

#### An√°lise Estat√≠stica
- Regress√£o linear para previs√µes
- An√°lise multivariada (ANOVA)
- Testes de hip√≥tese (t-Student)
- Matriz de correla√ß√£o sem√¢ntica
- Detec√ß√£o de outliers e anomalias

#### Auditabilidade
Todos os processos s√£o:
- ‚úÖ Rastre√°veis via logs estruturados
- ‚úÖ Versionados no sistema de controle
- ‚úÖ Cientificamente replic√°veis
- ‚úÖ Audit√°veis por terceiros

### Estudos de Caso Validados
Metodologia quantitativa e experimental aplicada em:
- **Setor educacional**: Institui√ß√µes de ensino
- **Sa√∫de digital**: Telemedicina e healthtech
- **Com√©rcio eletr√¥nico**: E-commerce e varejo

**Resultados Demonstrados**:
- Identifica√ß√£o de inconsist√™ncias simb√≥licas
- Detec√ß√£o de diverg√™ncias cognitivas
- Oportunidades de interven√ß√£o sem√¢ntica
- Padr√µes de alucina√ß√£o algor√≠tmica

---

## üêõ Bugs Corrigidos e Melhorias (14/11/2025)

### ‚úÖ Relat√≥rios Semanais Vazios (06/11/2025)

**Problema:** Emails de relat√≥rios chegavam sem dados.

**Causa Raiz:** 3 bugs cr√≠ticos na edge function `send-scheduled-weekly-reports`:
1. ‚ùå Tabela errada: `llm_mentions` ‚Üí ‚úÖ `mentions_llm`
2. ‚ùå Coluna errada: `created_at` ‚Üí ‚úÖ `collected_at`  
3. ‚ùå Campo inexistente: `relevance_score` ‚Üí ‚úÖ `confidence`

**Status:** ‚úÖ CORRIGIDO

### ‚úÖ Formata√ß√£o de Percentuais em PDFs (14/11/2025)

**Problema:** Valores percentuais com muitas casas decimais nos PDFs (ex: "36.37549999999995%")

**Solu√ß√£o:** Implementado arredondamento autom√°tico em `exportReports.ts` para:
- Presen√ßa Positiva
- T√≥picos GEO
- Confian√ßa das IAs

**Status:** ‚úÖ CORRIGIDO

### üöÄ Sistema de Retry Autom√°tico (14/11/2025)

**Implementa√ß√£o:**
- Retry autom√°tico com exponential backoff (at√© 3 tentativas)
- Implementado em `automation-orchestrator` e `calculate-geo-metrics`
- Delay: 1s, 2s, 4s (progressivo)
- Logs estruturados para troubleshooting

**Status:** ‚úÖ IMPLEMENTADO

### üìä Dashboard System Health (14/11/2025)

**Nova Funcionalidade:** `/system-health`

Monitoramento em tempo real:
- **Certifica√ß√£o Platinum**: Score geral do sistema (0-100%)
- **Breakdown por Setor**: Database, Edge Functions, Cron Jobs, Coleta de Dados, Integra√ß√µes
- **Execu√ß√µes Recentes**: √öltimos 10 jobs de automa√ß√£o
- **Status Operacional**: Healthy/Degraded/Unhealthy

**Status:** ‚úÖ IMPLEMENTADO

**Como Verificar:**
```sql
-- Ver dados inclu√≠dos no relat√≥rio
SELECT 
  b.name as marca,
  COUNT(*) as mencoes_7d,
  AVG(m.confidence) * 100 as score_medio
FROM brands b
LEFT JOIN mentions_llm m ON m.brand_id = b.id
WHERE m.collected_at >= CURRENT_DATE - INTERVAL '7 days'
  AND m.mentioned = true
GROUP BY b.name;
```

---

## Vis√£o Geral

Este sistema fornece an√°lise avan√ßada de GEO (Generative Engine Optimization) e IGO (Intelligence Governance Observability), monitoramento de marcas em m√∫ltiplos LLMs, com m√©tricas cognitivas inteligentes, converg√™ncia multi-LLM, gera√ß√£o autom√°tica de relat√≥rios e alertas baseados em IA.

### Funcionalidades Principais

#### üéØ GEO Analytics
- **GEO Score**: Pontua√ß√£o de otimiza√ß√£o para motores generativos (0-100)
- **SEO Integration**: Integra√ß√£o com m√©tricas de SEO tradicionais
- **URL Analysis**: An√°lise t√©cnica de URLs para GEO e SEO
- **Historical Tracking**: Acompanhamento hist√≥rico de performance

#### üß† IGO Framework (Intelligence Governance Observability)
- **CPI Score**: Cognitive Predictive Index - √çndice de previsibilidade cognitiva
- **ICE Metric**: Index of Cognitive Efficiency - Efici√™ncia cognitiva
- **GAP Metric**: Governance Alignment Precision - Precis√£o de alinhamento
- **Cognitive Stability**: Estabilidade das respostas ao longo do tempo
- **Multi-LLM Convergence**: Consenso e diverg√™ncia entre m√∫ltiplos LLMs
- **Intelligent Recommendations**: Recomenda√ß√µes baseadas em an√°lise matem√°tica com bot√µes de a√ß√£o r√°pida

#### üîÑ Multi-LLM Monitoring
- **Provider Coverage**: OpenAI, Perplexity, Google AI, Claude
- **Consensus Analysis**: An√°lise de concord√¢ncia entre provedores
- **Semantic Coherence**: Matriz de coer√™ncia sem√¢ntica
- **Divergence Detection**: Detec√ß√£o de diverg√™ncias significativas

#### üìä Advanced Analytics
- **AI-Powered Insights**: Insights gerados por IA
- **Predictive Analysis**: Previs√µes de tend√™ncias
- **Automated Reports**: Relat√≥rios autom√°ticos di√°rios/semanais
- **Real-time Alerts**: Alertas em tempo real configur√°veis
- **Quick Actions**: Bot√µes de a√ß√£o r√°pida nas recomenda√ß√µes para navega√ß√£o direta √†s funcionalidades relevantes

## Arquitetura de Dados

### Tabelas Principais

#### `brands`
Armazena informa√ß√µes das marcas monitoradas.
- `id`: UUID √∫nico da marca
- `name`: Nome da marca
- `domain`: Dom√≠nio da marca
- `user_id`: ID do usu√°rio propriet√°rio
- `created_at`: Data de cria√ß√£o

#### `geo_scores`
Armazena pontua√ß√µes GEO calculadas para cada marca.
- `id`: ID da pontua√ß√£o
- `brand_id`: Refer√™ncia √† marca
- `score`: Pontua√ß√£o num√©rica (0-100)
- `breakdown`: Detalhamento em JSON
- `computed_at`: Data/hora do c√°lculo

#### `mentions_llm`
Registra men√ß√µes da marca em diferentes LLMs.
- `id`: ID da men√ß√£o
- `brand_id`: Refer√™ncia √† marca
- `provider`: Provedor LLM (OpenAI, Perplexity, Google AI, Claude)
- `query`: Query usada para detec√ß√£o
- `mentioned`: Booleano indicando se foi mencionada
- `confidence`: N√≠vel de confian√ßa (0-1)
- `answer_excerpt`: Trecho da resposta
- `collected_at`: Data/hora da coleta

#### `scheduled_reports`
Configura relat√≥rios agendados por usu√°rio.
- `id`: UUID do agendamento
- `user_id`: ID do usu√°rio
- `frequency`: Frequ√™ncia (daily, weekly, monthly)
- `report_type`: Tipo (performance, mentions, comprehensive)
- `enabled`: Se est√° ativo
- `last_run`: √öltima execu√ß√£o
- `next_run`: Pr√≥xima execu√ß√£o agendada

#### `generated_reports`
Armazena relat√≥rios gerados.
- `id`: UUID do relat√≥rio
- `user_id`: ID do usu√°rio
- `report_type`: Tipo do relat√≥rio
- `content`: Conte√∫do em JSON
- `generated_at`: Data/hora de gera√ß√£o
- `email_sent`: Se foi enviado por email

#### `alert_configs`
Configura√ß√µes de alertas por usu√°rio.
- `id`: UUID da configura√ß√£o
- `user_id`: ID do usu√°rio
- `email`: Email para alertas
- `threshold_alert`: Se alerta por threshold est√° ativo
- `threshold_value`: Valor do threshold
- `score_decrease`: Alerta em queda de score
- `score_increase`: Alerta em aumento de score
- `weekly_report`: Receber relat√≥rio semanal
- `new_mention`: Alerta em nova men√ß√£o

#### `alerts_history`
Hist√≥rico de alertas enviados.
- `id`: UUID do alerta
- `user_id`: ID do usu√°rio
- `brand_id`: Refer√™ncia √† marca (opcional)
- `alert_type`: Tipo do alerta
- `title`: T√≠tulo do alerta
- `message`: Mensagem
- `priority`: Prioridade (low, medium, high)
- `read`: Se foi lido
- `metadata`: Dados adicionais em JSON

#### `igo_metrics_history`
Armazena hist√≥rico de m√©tricas IGO calculadas.
- `id`: UUID do registro
- `brand_id`: Refer√™ncia √† marca
- `user_id`: ID do usu√°rio propriet√°rio
- `ice`: Index of Cognitive Efficiency (0-100)
- `gap`: Governance Alignment Precision (0-100)
- `cpi`: Cognitive Predictive Index (0-100)
- `cognitive_stability`: Estabilidade cognitiva (0-100)
- `calculated_at`: Data/hora do c√°lculo
- `metadata`: Dados adicionais em JSON (consensus, divergence, etc.)

#### `ai_insights`
Armazena insights e previs√µes gerados por IA.
- `id`: UUID do insight
- `user_id`: ID do usu√°rio
- `brand_id`: Refer√™ncia √† marca (opcional)
- `insight_type`: Tipo do insight (prediction, recommendation, analysis)
- `content`: Conte√∫do do insight em JSON
- `confidence`: N√≠vel de confian√ßa (0-1)
- `generated_at`: Data/hora de gera√ß√£o
- `metadata`: Dados adicionais

## IGO Framework (Intelligence Governance Observability)

### Vis√£o Geral

O IGO Framework √© um sistema avan√ßado de m√©tricas cognitivas que avalia a governan√ßa e previsibilidade de marcas em m√∫ltiplos LLMs. Diferente do GEO Score tradicional, o IGO foca em aspectos cognitivos e de consenso entre diferentes modelos de IA.

### üîÑ Fluxo de Dados: Da Coleta ao Score Final

#### Entendendo os Componentes e Suas Fun√ß√µes

O sistema possui **TR√äS componentes principais** que trabalham juntos mas t√™m fun√ß√µes distintas:

##### 1Ô∏è‚É£ Nucleus Command Center (Coleta Granular)
**Localiza√ß√£o**: `/nucleus-command-center`

**Fun√ß√£o**: Coletar men√ß√µes detalhadas de m√∫ltiplos LLMs

**O que faz**:
- Envia queries para at√© 4 LLMs (OpenAI, Perplexity, Google AI, Claude)
- Registra CADA resposta individual na tabela `mentions_llm`
- Salva informa√ß√µes granulares:
  - Query espec√≠fica
  - Provider (qual LLM respondeu)
  - Se mencionou a marca (`mentioned: true/false`)
  - Confian√ßa da men√ß√£o (`confidence: 0-1`)
  - Trecho da resposta (`answer_excerpt`)
  - Data/hora da coleta (`collected_at`)

**Resultado**: Dados brutos de men√ß√µes na tabela `mentions_llm`

**‚ö†Ô∏è IMPORTANTE**: O Nucleus N√ÉO calcula scores! Ele s√≥ coleta e armazena dados brutos.

##### 2Ô∏è‚É£ Calculate GEO Metrics (Consolida√ß√£o GEO + CPI)
**Fun√ß√£o**: `calculate-geo-metrics`  
**Trigger**: Bot√£o "Atualizar Dados" na p√°gina `/geo-scores`

**O que faz**:
1. **L√™** todos os dados da tabela `mentions_llm` (coletados pelo Nucleus)
2. **Calcula** o GEO Score (0-100) baseado nos 5 pilares:
   - Base T√©cnica
   - Estrutura Sem√¢ntica
   - Relev√¢ncia Conversacional
   - Autoridade Cognitiva
   - Intelig√™ncia Estrat√©gica
3. **Calcula** o CPI Score (0-100) baseado na consist√™ncia das men√ß√µes:
   - Analisa varia√ß√£o de confian√ßa entre providers
   - Quanto menor a varia√ß√£o, maior o CPI
   - CPI alto = respostas consistentes entre LLMs
4. **Salva** ambos os scores na tabela `geo_scores`:
   - `score` (GEO Score)
   - `cpi` (CPI Score)
   - `breakdown` (detalhamento dos 5 pilares)
   - `computed_at` (timestamp do c√°lculo)

**Resultado**: Score √∫nico e consolidado por marca na tabela `geo_scores`

**Exibido em**: 
- P√°gina `/scores` (Widget "CPI Score /100")
- P√°gina `/geo-scores` (GEO Score detalhado)

##### 3Ô∏è‚É£ Calculate IGO Metrics (M√©tricas Avan√ßadas)
**Fun√ß√£o**: `calculate-igo-metrics`  
**Trigger**: Autom√°tico ap√≥s coleta no Nucleus (p√°gina `/algorithmic-governance`)

**O que faz**:
1. **L√™** dados da tabela `mentions_llm`
2. **Calcula** m√©tricas IGO avan√ßadas:
   - **ICE** (Index of Cognitive Efficiency): efici√™ncia de men√ß√µes corretas
   - **GAP** (Governance Alignment Precision): consenso entre LLMs
   - **CPI IGO**: vers√£o IGO do CPI com an√°lise de converg√™ncia
   - **Cognitive Stability**: estabilidade temporal das respostas
3. **Salva** na tabela `igo_metrics_history`

**Resultado**: M√©tricas avan√ßadas de governan√ßa cognitiva

**Exibido em**: P√°gina `/algorithmic-governance` (Dashboard IGO)

#### üìä Fluxo Visual Completo

```mermaid
graph TD
    A[Nucleus: Coleta LLMs] -->|Salva| B[mentions_llm]
    B -->|L√™ dados| C[calculate-geo-metrics]
    B -->|L√™ dados| D[calculate-igo-metrics]
    C -->|Salva| E[geo_scores]
    D -->|Salva| F[igo_metrics_history]
    E -->|Exibe| G[/scores - Widget CPI]
    E -->|Exibe| H[/geo-scores - GEO Score]
    F -->|Exibe| I[/algorithmic-governance - IGO]
```

#### üéØ Por Que Existem Dois CPIs?

**CPI na tabela `geo_scores`**:
- Score √∫nico e simples (0-100)
- Focado em consist√™ncia de men√ß√µes
- Usado no dashboard principal (`/scores`)
- C√°lculo mais direto baseado em vari√¢ncia

**CPI IGO na tabela `igo_metrics_history`**:
- M√©trica avan√ßada com contexto (0-100)
- Inclui an√°lise de converg√™ncia multi-LLM
- Usado no dashboard de Governan√ßa (`/algorithmic-governance`)
- C√°lculo composto: `(0.4 √ó ICE) + (0.3 √ó GAP) + (0.3 √ó Stability)`

Ambos medem previsibilidade, mas com n√≠veis diferentes de complexidade e aplica√ß√£o.

#### ‚ùì Por Que o CPI Mostrava Zero (PROBLEMA RESOLVIDO)?

**Problema Antigo**: Ap√≥s rodar o Nucleus, o Widget CPI mostrava `0.0 / 100`

**Causa**: 
1. Nucleus coletou dados ‚Üí tabela `mentions_llm` ‚úÖ
2. MAS `calculate-geo-metrics` N√ÉO era executado automaticamente ‚ùå
3. Logo, a tabela `geo_scores` n√£o tinha o campo `cpi` preenchido (era `null`)
4. O Widget l√™ de `geo_scores.cpi` e exibe `0.0` se `null`/`undefined`

**‚úÖ Solu√ß√£o Implementada (21/11/2025)**:
- Sistema agora executa **automaticamente** `calculate-geo-metrics` ap√≥s o Nucleus
- N√£o precisa mais ir em `/geo-scores` e clicar "Atualizar Dados"
- CPI √© calculado e salvo imediatamente ap√≥s a coleta
- Widget CPI sempre mostra o valor correto e atualizado

**Fluxo Antigo (Manual)**:
```
Nucleus ‚Üí mentions_llm ‚Üí [USU√ÅRIO clica "Atualizar Dados"] ‚Üí calculate-geo-metrics ‚Üí geo_scores ‚Üí Widget
```

**Fluxo Novo (Autom√°tico)**:
```
Nucleus ‚Üí mentions_llm ‚Üí calculate-geo-metrics (auto) ‚Üí geo_scores ‚Üí Widget ‚úÖ
```


#### üîÑ Fluxo Automatizado Completo

```
1. Coleta de Dados (Nucleus)
   ‚îî‚îÄ> /nucleus-command-center OU /algorithmic-governance
   ‚îî‚îÄ> Selecionar marca + LLMs + queries
   ‚îî‚îÄ> Executar coleta
   ‚îî‚îÄ> Dados salvos em mentions_llm ‚úÖ

2. C√°lculo Autom√°tico (Sem interven√ß√£o!)
   ‚îî‚îÄ> Sistema automaticamente executa:
       ‚îú‚îÄ> calculate-geo-metrics ‚Üí Calcula GEO + CPI
       ‚îî‚îÄ> calculate-igo-metrics ‚Üí Calcula IGO
   ‚îî‚îÄ> Scores salvos em geo_scores + igo_metrics_history ‚úÖ

3. Visualiza√ß√£o (Imediata)
   ‚îî‚îÄ> /scores ‚Üí Ver CPI consolidado atualizado
   ‚îî‚îÄ> /geo-scores ‚Üí Ver GEO detalhado atualizado
   ‚îî‚îÄ> /algorithmic-governance ‚Üí Ver m√©tricas IGO atualizadas
```

**üéØ Automa√ß√£o Implementada (21/11/2025)**:
- ‚úÖ Ap√≥s Nucleus terminar ‚Üí `calculate-geo-metrics` roda automaticamente
- ‚úÖ Ap√≥s Nucleus terminar ‚Üí `calculate-igo-metrics` roda automaticamente
- ‚úÖ Usu√°rio n√£o precisa clicar em "Atualizar Dados" manualmente
- ‚úÖ Todos os scores ficam sincronizados instantaneamente

---

#### üìå Pontos-Chave para Entender

1. **Nucleus = Coleta, e agora tamb√©m automatiza c√°lculos**
   - Ele popula `mentions_llm` com dados brutos
   - **NOVO**: Automaticamente chama `calculate-geo-metrics` e `calculate-igo-metrics`

2. **calculate-geo-metrics = Consolida√ß√£o autom√°tica**
   - Transforma dados brutos em scores √∫nicos
   - **AGORA roda automaticamente ap√≥s o Nucleus**

3. **geo_scores = Fonte √∫nica de verdade para `/scores`**
   - Widget CPI l√™ EXCLUSIVAMENTE desta tabela
   - Se `cpi` for `null`, exibe `0.0`
   - **Agora sempre atualizado automaticamente**

4. **Dois sistemas, duas finalidades**:
   - `geo_scores.cpi` ‚Üí Dashboard principal, score simples
   - `igo_metrics_history.cpi` ‚Üí Governan√ßa avan√ßada, an√°lise profunda

5. **‚úÖ Automa√ß√£o completa implementada**:
   - Nucleus ‚Üí Manual (usu√°rio clica "Executar")
   - calculate-geo-metrics ‚Üí **Autom√°tico ap√≥s Nucleus**
   - calculate-igo-metrics ‚Üí **Autom√°tico ap√≥s Nucleus**
   - **N√£o precisa mais clicar "Atualizar Dados"!**

---

### M√©tricas IGO

#### 1. ICE (Index of Cognitive Efficiency)
**Defini√ß√£o**: Mede a efici√™ncia com que a marca √© mencionada corretamente pelos LLMs.

**C√°lculo**:
```javascript
ICE = (men√ß√µes_corretas / total_men√ß√µes) √ó 100
```

**Interpreta√ß√£o**:
- **90-100**: Excelente - Alta efici√™ncia cognitiva
- **70-89**: Bom - Efici√™ncia adequada
- **50-69**: Regular - Necessita melhorias
- **0-49**: Cr√≠tico - Baixa efici√™ncia

**Fatores que influenciam**:
- Qualidade das men√ß√µes
- Contexto correto da marca
- Precis√£o das respostas dos LLMs

#### 2. GAP (Governance Alignment Precision)
**Defini√ß√£o**: Avalia o alinhamento entre diferentes provedores LLM ao mencionar a marca.

**C√°lculo**:
```javascript
GAP = (provedores_alinhados / total_provedores) √ó 100 √ó fator_consenso
```

**Interpreta√ß√£o**:
- **85-100**: Excelente - Alto consenso entre LLMs
- **65-84**: Bom - Consenso satisfat√≥rio
- **45-64**: Regular - Diverg√™ncias moderadas
- **0-44**: Cr√≠tico - Alta diverg√™ncia

**Fatores que influenciam**:
- Consenso entre provedores
- Coer√™ncia sem√¢ntica
- Uniformidade de respostas

#### 3. CPI (Cognitive Predictive Index)
**Defini√ß√£o**: √çndice composto que prediz a governan√ßa cognitiva da marca.

**C√°lculo**:
```javascript
CPI = (0.4 √ó ICE) + (0.3 √ó GAP) + (0.3 √ó Cognitive_Stability)
```

**Interpreta√ß√£o**:
- **80-100**: Excelente - Alta previsibilidade
- **60-79**: Bom - Previsibilidade adequada
- **40-59**: Regular - Previsibilidade moderada
- **0-39**: Cr√≠tico - Baixa previsibilidade

**Uso estrat√©gico**:
- Principal indicador de governan√ßa cognitiva
- Base para previs√µes de performance
- Guia para estrat√©gias de otimiza√ß√£o

#### 4. Cognitive Stability
**Defini√ß√£o**: Mede a estabilidade das respostas dos LLMs ao longo do tempo.

**C√°lculo**:
```javascript
Stability = 100 - (varia√ß√£o_temporal √ó 100)
```

**Interpreta√ß√£o**:
- **90-100**: Excelente - Respostas muito est√°veis
- **75-89**: Bom - Estabilidade adequada
- **50-74**: Regular - Varia√ß√µes moderadas
- **0-49**: Cr√≠tico - Alta volatilidade

### Multi-LLM Convergence System

#### An√°lise de Consenso

O sistema analisa a converg√™ncia entre m√∫ltiplos provedores LLM para identificar:

1. **Consenso Total**: Todos os LLMs mencionam a marca de forma similar
2. **Consenso Parcial**: Maioria dos LLMs concorda, com diverg√™ncias menores
3. **Diverg√™ncia Moderada**: Respostas variadas entre provedores
4. **Diverg√™ncia Cr√≠tica**: Respostas conflitantes ou inconsistentes

### Sistema de Recomenda√ß√µes Inteligentes com Quick Actions

#### Vis√£o Geral

A p√°gina de Governan√ßa Algor√≠tmica oferece recomenda√ß√µes inteligentes baseadas em an√°lise matem√°tica das m√©tricas IGO atuais. Cada recomenda√ß√£o inclui **bot√µes de a√ß√£o r√°pida** que permitem navegar diretamente para a funcionalidade necess√°ria para resolver o problema identificado.

#### Tipos de Quick Actions

| Recomenda√ß√£o | Bot√£o de A√ß√£o | Destino | Quando Aparece |
|--------------|---------------|---------|----------------|
| CPI Cr√≠tico / Contexto da Marca | **‚úèÔ∏è Editar Contexto da Marca** | `/brands` | Quando o CPI est√° baixo ou h√° men√ß√£o de contexto inadequado |
| Estabilidade Cognitiva / GAP | **üëÅÔ∏è Ver IGO Observability** | `/igo-observability?brandId={id}` | Para an√°lises detalhadas de estabilidade e governan√ßa com marca pr√©-selecionada |
| Diverg√™ncia Multi-LLM | **üîç Detectar Alucina√ß√µes** | `/igo-observability?brandId={id}` | Quando h√° diverg√™ncias cr√≠ticas entre LLMs com marca pr√©-selecionada |
| An√°lise Multi-LLM | **üîó Ver Men√ß√µes LLM** | `/llm-mentions?brandId={id}` | Para visualizar men√ß√µes espec√≠ficas de cada LLM com marca pr√©-selecionada |

**IMPORTANTE**: Os bot√µes que navegam para IGO Observability e LLM Mentions passam automaticamente o ID da marca selecionada via URL, de modo que ao abrir essas p√°ginas, a marca j√° est√° pr√©-selecionada, mantendo o contexto da an√°lise.

#### Como Usar

1. **Selecione uma marca** na p√°gina de Governan√ßa Algor√≠tmica
2. **Navegue at√© a aba "Recomenda√ß√µes"**
3. **Revise as recomenda√ß√µes** apresentadas com suas prioridades (CR√çTICO, ALTO, M√âDIO, INFO)
4. **Clique no bot√£o de a√ß√£o apropriado** para ir direto √† funcionalidade que resolve o problema
5. **Execute as a√ß√µes recomendadas** na p√°gina de destino

#### Exemplo de Fluxo

```
1. Sistema detecta CPI baixo (45%)
   ‚Üì
2. Gera recomenda√ß√£o: "CPI Cr√≠tico: Alta Diverg√™ncia entre LLMs"
   ‚Üì
3. Usu√°rio clica em "‚úèÔ∏è Editar Contexto da Marca"
   ‚Üì
4. Sistema navega para /brands
   ‚Üì
5. Usu√°rio edita e melhora o contexto da marca
   ‚Üì
6. Pr√≥ximo c√°lculo de IGO reflete a melhoria
```

#### Benef√≠cios

- ‚úÖ **A√ß√£o Imediata**: Navega√ß√£o direta sem precisar procurar manualmente
- ‚úÖ **Contexto Preservado**: Sabe exatamente qual problema est√° resolvendo
- ‚úÖ **Efici√™ncia**: Reduz tempo de diagn√≥stico ‚Üí a√ß√£o
- ‚úÖ **Guiado**: Sistema indica exatamente onde agir

#### Matriz de Coer√™ncia Sem√¢ntica

Avalia a coer√™ncia sem√¢ntica entre diferentes respostas:

```
              OpenAI  Perplexity  Google AI  Claude
OpenAI          100%       85%        92%      88%
Perplexity       85%      100%        78%      82%
Google AI        92%       78%       100%      90%
Claude           88%       82%        90%     100%
```

#### Detec√ß√£o de Diverg√™ncias

**Tipos de diverg√™ncias monitoradas**:
- **Sem√¢ntica**: Significados diferentes
- **Contextual**: Contextos distintos
- **Factual**: Informa√ß√µes conflitantes
- **Aus√™ncia**: Men√ß√£o vs. n√£o-men√ß√£o

### Edge Function: calculate-igo-metrics

**Prop√≥sito**: Calcula todas as m√©tricas IGO para uma marca.

**Entrada**:
```typescript
{
  brandId?: string,  // Opcional - calcula para todas as marcas se omitido
  period?: number    // Dias a considerar (padr√£o: 30)
}
```

**Processo**:
1. Busca men√ß√µes dos √∫ltimos N dias
2. Calcula ICE baseado em qualidade das men√ß√µes
3. Calcula GAP baseado em consenso entre provedores
4. Calcula Cognitive Stability baseado em varia√ß√£o temporal
5. Calcula CPI como √≠ndice composto
6. Salva resultados em `igo_metrics_history`

**Sa√≠da**:
```typescript
{
  ice: number,
  gap: number,
  cpi: number,
  cognitive_stability: number,
  metadata: {
    consensus_rate: number,
    divergence_count: number,
    providers_analyzed: string[],
    calculation_date: string
  }
}
```

### Relat√≥rios IGO

O sistema gera relat√≥rios espec√≠ficos IGO que incluem:

1. **Dashboard IGO**: Visualiza√ß√£o em tempo real das m√©tricas
2. **Compara√ß√£o entre Marcas**: Benchmarking de m√©tricas IGO
3. **Evolu√ß√£o Temporal**: Gr√°ficos de tend√™ncia das m√©tricas
4. **An√°lise de Converg√™ncia**: Matriz de consenso entre LLMs
5. **Insights Preditivos**: Previs√µes baseadas em padr√µes hist√≥ricos

### Exporta√ß√£o de Relat√≥rios IGO

**Formato PDF**: Inclui:
- Resumo executivo das m√©tricas IGO
- Tabela comparativa entre marcas
- An√°lise interpretativa autom√°tica
- Gr√°ficos de evolu√ß√£o temporal
- Matriz de coer√™ncia sem√¢ntica
- Recomenda√ß√µes estrat√©gicas

**Gera√ß√£o**:
```typescript
import { exportIGOReport } from '@/utils/exportIGOReport';

await exportIGOReport({
  brandsMetrics: [...],
  period: 'monthly',
  generatedAt: new Date()
});
```

## Sistema de Relat√≥rios Agendados

### Fluxo de Funcionamento

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    CRON Job (Daily 8AM)                  ‚îÇ
‚îÇ          send-scheduled-reports-daily                    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                     ‚îÇ
                     ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ        Edge Function: send-scheduled-weekly-reports      ‚îÇ
‚îÇ                                                           ‚îÇ
‚îÇ  1. Busca todos os usu√°rios                              ‚îÇ
‚îÇ  2. Para cada usu√°rio:                                   ‚îÇ
‚îÇ     - Busca suas marcas                                  ‚îÇ
‚îÇ     - Busca men√ß√µes da √∫ltima semana                     ‚îÇ
‚îÇ     - Busca men√ß√µes da semana anterior                   ‚îÇ
‚îÇ     - Calcula m√©tricas (score, tend√™ncia)                ‚îÇ
‚îÇ  3. Chama send-weekly-report para enviar email           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                     ‚îÇ
                     ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ          Edge Function: send-weekly-report               ‚îÇ
‚îÇ                                                           ‚îÇ
‚îÇ  1. Recebe dados do relat√≥rio                            ‚îÇ
‚îÇ  2. Formata HTML do email                                ‚îÇ
‚îÇ  3. Envia via Resend API                                 ‚îÇ
‚îÇ  4. Retorna status do envio                              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### C√°lculo de M√©tricas

#### Relevance Score
```javascript
relevanceScore = (totalMentions > 0) 
  ? (mentionedCount / totalMentions) * 100 
  : 0
```

#### Tend√™ncia
Compara men√ß√µes da semana atual vs. semana anterior:
- `up`: Aumento de men√ß√µes
- `down`: Diminui√ß√£o de men√ß√µes
- `stable`: Mesma quantidade

### Configura√ß√£o do Cron Job - RELAT√ìRIOS DI√ÅRIOS

‚úÖ **CONFIGURADO:** Relat√≥rios rodam automaticamente TODOS OS DIAS √†s 8:00 AM

**Configura√ß√£o Atual:**

```sql
-- Relat√≥rios DI√ÅRIOS √†s 8:00 AM
SELECT cron.schedule(
  'daily-geo-reports',
  '0 8 * * *',  -- Todos os dias √†s 8:00 AM
  $$
  SELECT net.http_post(
    url := 'https://llzonwqocqzqpezcsbjh.supabase.co/functions/v1/send-scheduled-weekly-reports',
    headers := jsonb_build_object(
      'Content-Type', 'application/json',
      'Authorization', 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imxsem9ud3FvY3F6cXBlemNzYmpoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE3ODMzNjgsImV4cCI6MjA3NzM1OTM2OH0.z_8tiINK0X_hFSvsyWAt7Kf-O3ANQTqCNNpgo3_fJ5I'
    ),
    body := '{}'::jsonb
  ) AS request_id;
  $$
);
```

**Verificar status do cron:**

```sql
-- Ver cron jobs ativos
SELECT * FROM cron.job WHERE jobname = 'daily-geo-reports';

-- Ver √∫ltimas execu√ß√µes
SELECT * FROM cron.job_run_details 
WHERE jobid = (SELECT jobid FROM cron.job WHERE jobname = 'daily-geo-reports')
ORDER BY start_time DESC 
LIMIT 10;
```

**Conte√∫do do Relat√≥rio Di√°rio:**
- üìä Dados das **√∫ltimas 24 horas**
- üìà Compara√ß√£o com **dia anterior** (24-48h atr√°s)
- üéØ Scores, tend√™ncias e n√∫mero de men√ß√µes por marca
- üìß Enviado para: **jose.vev26@gmail.com**

## Edge Functions

### 1. `send-scheduled-weekly-reports`
**Prop√≥sito**: Coordena a gera√ß√£o e envio de relat√≥rios semanais.

**Processo**:
1. Busca todos os usu√°rios autenticados
2. Para cada usu√°rio:
   - Busca marcas associadas
   - Coleta men√ß√µes da √∫ltima semana
   - Coleta men√ß√µes da semana anterior
   - Calcula scores e tend√™ncias
   - Invoca `send-weekly-report`

**Dados Calculados**:
```typescript
{
  brands: [
    {
      name: string,
      currentRelevance: number,
      previousRelevance: number,
      mentionCount: number,
      trend: 'up' | 'down' | 'stable'
    }
  ]
}
```

### 2. `send-weekly-report`
**Prop√≥sito**: Formata e envia o email do relat√≥rio.

**Entrada**:
```typescript
{
  email: string,
  userName: string,
  brands: BrandData[]
}
```

**Sa√≠da**:
- Email HTML formatado
- Status do envio via Resend

**Template do Email**:
- Header com logo e t√≠tulo
- Se√ß√£o de resumo executivo
- Lista de marcas com m√©tricas
- Indicadores visuais de tend√™ncia
- Footer com links

### 3. `collect-llm-mentions`
**Prop√≥sito**: Coleta men√ß√µes de marcas em diferentes LLMs.

**Providers Suportados**:
- OpenAI (GPT-4)
- Perplexity
- Google AI (Gemini)
- Claude (via Lovable AI)

**Processo**:
1. Busca dados da marca
2. Gera queries de teste
3. Consulta cada provider
4. Analisa respostas para detectar men√ß√µes
5. Salva resultados em `mentions_llm`

**Queries de Teste**:
```javascript
[
  "What are the best {category} companies?",
  "Compare top {category} solutions",
  "Who are the leaders in {category}?",
  // ... mais queries
]
```

### 4. `ai-predictions`
**Prop√≥sito**: Gera previs√µes e sugest√µes usando IA.

**Entrada**:
```typescript
{
  userId: string,
  brandId?: string
}
```

**Processo**:
1. Busca dados hist√≥ricos (scores, men√ß√µes)
2. Envia para Lovable AI
3. Recebe previs√µes e sugest√µes
4. Salva em `ai_insights`

### 5. `analyze-url`
**Prop√≥sito**: Analisa URL para GEO e SEO.

**Sa√≠da**:
```typescript
{
  geo_score: number,
  seo_score: number,
  overall_score: number,
  analysis: {
    geo: { ... },
    seo: { ... }
  },
  recommendations: string[],
  tasks: Task[]
}
```

### 6. `calculate-igo-metrics`
**Prop√≥sito**: Calcula m√©tricas IGO (ICE, GAP, CPI, Cognitive Stability) para marcas.

**Entrada**:
```typescript
{
  brandId?: string,  // Opcional - calcula para todas se omitido
  period?: number    // Dias a considerar (padr√£o: 30)
}
```

**Processo**:
1. Autentica usu√°rio via Bearer token
2. Busca men√ß√µes da marca dos √∫ltimos N dias
3. Calcula ICE baseado em qualidade das men√ß√µes
4. Calcula GAP baseado em consenso entre provedores
5. Calcula Cognitive Stability baseado em varia√ß√£o temporal
6. Calcula CPI como √≠ndice composto
7. Salva em `igo_metrics_history` se brandId fornecido

**Sa√≠da**:
```typescript
{
  ice: number,              // 0-100
  gap: number,              // 0-100
  cpi: number,              // 0-100
  cognitive_stability: number, // 0-100
  metadata: {
    consensus_rate: number,
    divergence_count: number,
    providers_analyzed: string[],
    total_mentions: number
  }
}
```

### 7. `ai-report-generator`
**Prop√≥sito**: Gera relat√≥rios GEO e IGO usando IA.

**Entrada**:
```typescript
{
  userId: string,
  reportType: 'geo' | 'igo' | 'comprehensive',
  brandIds?: string[],
  period: 'weekly' | 'monthly' | 'quarterly'
}
```

**Processo**:
1. Busca dados das marcas (scores, men√ß√µes, alertas)
2. Prepara resumo de dados para IA
3. Constr√≥i prompt detalhado baseado no tipo de relat√≥rio
4. Envia para Lovable AI (gemini-2.5-pro)
5. Processa resposta JSON da IA
6. Salva em `ai_insights`
7. Retorna relat√≥rio formatado

**Tipos de Relat√≥rio**:
- **GEO**: Foca em scores GEO, SEO e performance
- **IGO**: Foca em m√©tricas cognitivas (CPI, ICE, GAP)
- **Comprehensive**: Combina ambos os aspectos

**Sa√≠da**:
```typescript
{
  summary: string,
  metrics: {
    current: { ... },
    trend: string,
    comparison: string
  },
  insights: string[],
  recommendations: string[],
  predictions: {
    next_period: { ... },
    confidence: number
  }
}
```

## Sistema de Alertas

### Tipos de Alertas

1. **Threshold Alert**: Score cruza um valor definido
2. **Score Decrease**: Pontua√ß√£o diminui
3. **Score Increase**: Pontua√ß√£o aumenta
4. **New Mention**: Nova men√ß√£o detectada

### Fluxo de Alertas

```
Evento (mudan√ßa em score/men√ß√£o)
    ‚Üì
Verifica alert_configs do usu√°rio
    ‚Üì
Se configurado, cria em alerts_history
    ‚Üì
Envia email (opcional)
    ‚Üì
Exibe no painel de alertas
```

## APIs Externas

### Lovable AI
- **URL**: `https://ai.gateway.lovable.dev/v1/chat/completions`
- **Modelos**: 
  - `google/gemini-2.5-flash` (padr√£o)
  - `google/gemini-2.5-pro`
  - `openai/gpt-5`
- **Uso**: An√°lise de dados, previs√µes, gera√ß√£o de relat√≥rios

### Resend
- **URL**: `https://api.resend.com/emails`
- **Uso**: Envio de emails (relat√≥rios, alertas)
- **Requer**: `RESEND_API_KEY`

### LLM Providers
- **OpenAI**: API para GPT-4
- **Perplexity**: API de busca com IA
- **Google AI**: Gemini API
- **Claude**: Via Lovable AI Gateway

## Seguran√ßa (RLS)

Todas as tabelas implementam Row Level Security (RLS):

```sql
-- Exemplo: brands
CREATE POLICY "Users can view their own brands"
ON brands FOR SELECT
USING (auth.uid() = user_id);

CREATE POLICY "Users can insert their own brands"
ON brands FOR INSERT
WITH CHECK (auth.uid() = user_id);

-- Similar para UPDATE e DELETE
```

**Princ√≠pio**: Usu√°rios s√≥ acessam seus pr√≥prios dados.

## Vari√°veis de Ambiente

### Supabase
- `SUPABASE_URL`: URL do projeto
- `SUPABASE_ANON_KEY`: Chave p√∫blica
- `SUPABASE_SERVICE_ROLE_KEY`: Chave admin (edge functions)

### APIs Externas
- `LOVABLE_API_KEY`: Lovable AI Gateway
- `RESEND_API_KEY`: Envio de emails
- `OPENAI_API_KEY`: OpenAI API
- `PERPLEXITY_API_KEY`: Perplexity API
- `GOOGLE_AI_API_KEY`: Google AI API

## Manuten√ß√£o e Monitoramento

### Logs
Edge functions geram logs acess√≠veis no painel do Supabase:
- Erros de API
- Envios de email
- Execu√ß√µes de cron
- Processamento de dados

### Verifica√ß√£o do Cron
```sql
SELECT * FROM cron.job;
SELECT * FROM cron.job_run_details ORDER BY start_time DESC LIMIT 10;
```

### Testes Manuais

#### Testar envio de relat√≥rio:
```bash
curl -X POST \
  https://llzonwqocqzqpezcsbjh.supabase.co/functions/v1/send-weekly-report \
  -H "Content-Type: application/json" \
  -d '{
    "email": "test@example.com",
    "userName": "Test User",
    "brands": [...]
  }'
```

#### Testar coleta de men√ß√µes:
```bash
curl -X POST \
  https://llzonwqocqzqpezcsbjh.supabase.co/functions/v1/collect-llm-mentions \
  -H "Content-Type: application/json" \
  -d '{"brandId": "uuid-here"}'
```

## Pr√≥ximos Passos / Melhorias

### ‚úÖ Implementado
1. **Dashboard IGO**: Visualiza√ß√£o em tempo real de m√©tricas cognitivas
2. **CPI Score**: √çndice de previsibilidade cognitiva implementado
3. **Multi-LLM Convergence**: Sistema de an√°lise de consenso entre provedores
4. **Relat√≥rios IGO**: Exporta√ß√£o de relat√≥rios IGO em PDF
5. **Relat√≥rios CPI**: Exporta√ß√£o de relat√≥rios CPI Dashboard em PDF
6. **AI-Powered Insights**: Insights gerados por Lovable AI
7. **Cognitive Stability**: M√©tricas de estabilidade temporal
8. **Semantic Coherence Matrix**: An√°lise de coer√™ncia sem√¢ntica

### üöß Em Desenvolvimento
1. **Webhooks**: Notificar sistemas externos de mudan√ßas
2. **Cache Avan√ßado**: Reduzir chamadas a APIs externas com cache inteligente
3. **Testes Automatizados E2E**: Cobertura completa de testes
4. **Rate Limiting Din√¢mico**: Prote√ß√£o adaptativa contra abuso
5. **API P√∫blica**: Endpoints para integra√ß√£o externa

### üìã Planejado
1. **Machine Learning Predictions**: Modelos ML para previs√µes mais precisas
2. **Real-time Streaming**: Atualiza√ß√£o de m√©tricas em tempo real
3. **Custom Dashboards**: Dashboards personaliz√°veis por usu√°rio
4. **Advanced Analytics**: An√°lise de sentimento e contexto
5. **Multi-tenant Support**: Suporte para m√∫ltiplas organiza√ß√µes

## Exporta√ß√£o de Relat√≥rios

### Relat√≥rio CPI Dashboard (PDF)

**Arquivo**: `src/utils/exportCPIDashboardReport.ts`

**Funcionalidade**:
- Exporta dashboard completo de CPI em formato PDF
- Inclui resumo executivo de m√©tricas CPI
- Tabelas de KPIs detalhadas
- Dados de consenso multi-LLM
- Insights gerados automaticamente
- Gr√°ficos capturados (charts)

**Uso**:
```typescript
import { exportCPIDashboardReport } from '@/utils/exportCPIDashboardReport';

await exportCPIDashboardReport({
  cpiMetrics: {
    currentCPI: 85.5,
    previousCPI: 82.3,
    trend: 'up',
    ice: 88.2,
    gap: 84.1,
    stability: 91.5
  },
  kpis: [...],
  consensus: [...],
  period: 'monthly'
});
```

**Se√ß√µes do PDF**:
1. **Header**: T√≠tulo, per√≠odo e data de gera√ß√£o
2. **CPI Score Summary**: Score atual, anterior e tend√™ncia
3. **M√©tricas IGO**: ICE, GAP, Cognitive Stability
4. **Tabela de KPIs**: Detalhamento de todos os KPIs
5. **Consenso LLM**: Dados de converg√™ncia entre provedores
6. **Insights Gerados**: An√°lise interpretativa autom√°tica
7. **Gr√°ficos**: Charts capturados do dashboard
8. **Footer**: Pagina√ß√£o e informa√ß√µes da empresa

### Relat√≥rio IGO (PDF)

**Arquivo**: `src/utils/exportIGOReport.ts`

**Funcionalidade**:
- Exporta an√°lise completa IGO em PDF
- Compara√ß√£o entre m√∫ltiplas marcas
- Evolu√ß√£o temporal das m√©tricas
- Matriz de coer√™ncia sem√¢ntica
- An√°lise de diverg√™ncia entre LLMs

**Uso**:
```typescript
import { exportIGOReport } from '@/utils/exportIGOReport';

await exportIGOReport({
  brandsMetrics: [
    {
      brand: { id: '...', name: 'Marca A' },
      metrics: {
        ice: 88.5,
        gap: 85.2,
        cpi: 87.1,
        cognitive_stability: 92.3
      }
    }
  ],
  period: 'monthly',
  generatedAt: new Date()
});
```

**Se√ß√µes do PDF**:
1. **Header e Descri√ß√£o**: Contexto do framework IGO
2. **Tabela Comparativa**: M√©tricas de todas as marcas
3. **An√°lise Interpretativa**: Insights autom√°ticos
4. **Gr√°fico de Evolu√ß√£o**: Tend√™ncias temporais
5. **Timeline de Eventos**: Marcos importantes
6. **Diverg√™ncia Sem√¢ntica**: An√°lise de discrep√¢ncias
7. **Compara√ß√£o de Provedores**: Performance por LLM
8. **Recomenda√ß√µes**: A√ß√µes sugeridas

### Relat√≥rio T√©cnico Completo (PDF)

**Arquivo**: `src/utils/generateTechnicalPDF.ts`

**Funcionalidade**:
- Documenta√ß√£o t√©cnica completa do sistema
- Arquitetura e componentes
- M√©tricas e f√≥rmulas
- Fluxos de dados
- Especifica√ß√µes de APIs

**Componente**:
```typescript
import { DownloadTechnicalPDF } from '@/components/DownloadTechnicalPDF';

<DownloadTechnicalPDF />
```

## F√≥rmulas e C√°lculos

### GEO Score
```javascript
GEO_Score = (
  0.30 √ó Visibility_Score +      // Visibilidade em LLMs
  0.25 √ó Relevance_Score +       // Relev√¢ncia contextual
  0.20 √ó Citation_Quality +      // Qualidade das cita√ß√µes
  0.15 √ó Provider_Coverage +     // Cobertura de provedores
  0.10 √ó Temporal_Consistency    // Consist√™ncia temporal
) √ó 100
```

### CPI (Cognitive Predictive Index)
```javascript
CPI = (
  0.40 √ó ICE +                   // Efici√™ncia cognitiva
  0.30 √ó GAP +                   // Precis√£o de alinhamento
  0.30 √ó Cognitive_Stability     // Estabilidade
)
```

### ICE (Index of Cognitive Efficiency)
```javascript
ICE = (mentions_correct / mentions_total) √ó 100

// Onde:
// mentions_correct = men√ß√µes com contexto correto
// mentions_total = total de men√ß√µes analisadas
```

### GAP (Governance Alignment Precision)
```javascript
GAP = (providers_aligned / providers_total) √ó 100 √ó consensus_factor

// Onde:
// providers_aligned = provedores com respostas alinhadas
// providers_total = total de provedores consultados
// consensus_factor = fator de qualidade do consenso (0.8-1.0)
```

### Cognitive Stability
```javascript
Stability = 100 - (temporal_variance √ó 100)

// Onde:
// temporal_variance = varia√ß√£o das respostas ao longo do tempo
// Calculado como desvio padr√£o normalizado
```

### Consenso Multi-LLM
```javascript
Consensus_Rate = (
  Œ£(similarity_scores) / total_comparisons
) √ó 100

// Onde:
// similarity_scores = scores de similaridade entre pares de LLMs
// total_comparisons = n√∫mero de compara√ß√µes realizadas
```

## Suporte

Para quest√µes ou problemas:
1. Verificar logs no painel do Lovable Cloud
2. Testar edge functions individualmente
3. Verificar configura√ß√µes de alertas e agendamentos
4. Validar vari√°veis de ambiente
